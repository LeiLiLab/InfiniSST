#!/bin/bash

# ACL评估使用示例脚本

echo "=== ACL Evaluation Examples ==="
echo ""

echo "1. 标准ACL评估（使用single best model）:"
echo "bash SONAR_ACL_test.sh 2 term true data/samples/xl/term_level_chunks_500000_1000000.json true"
echo ""

echo "2. ACL评估（使用full best model）:"
echo "bash SONAR_ACL_test.sh 2 term false data/samples/xl/term_level_chunks_500000_1000000.json true"
echo ""

echo "3. 直接调用Python脚本进行ACL评估:"
echo "python3 SONAR_ACL_test.py \\"
echo "  --model_path data/clap_sonar_term_level_single_best.pt \\"
echo "  --acl_mode \\"
echo "  --acl_root_dir data/acl-6060/2/acl_6060 \\"
echo "  --acl_glossary_path data/acl-6060/2/intermediate_files/terminology_glossary.csv \\"
echo "  --acl_test_split eval \\"
echo "  --acl_index_split dev \\"
echo "  --acl_segmentation gold \\"
echo "  --max_eval 1000"
echo ""

echo "4. 使用不同配置的ACL评估:"
echo "# 使用dev作为测试集"
echo "python3 SONAR_ACL_test.py \\"
echo "  --model_path data/clap_sonar_term_level_single_best.pt \\"
echo "  --acl_mode \\"
echo "  --acl_test_split dev \\"
echo "  --acl_index_split dev \\"
echo "  --acl_segmentation gold"
echo ""
echo "# 使用shas分段"
echo "python3 SONAR_ACL_test.py \\"
echo "  --model_path data/clap_sonar_term_level_single_best.pt \\"
echo "  --acl_mode \\"
echo "  --acl_test_split eval \\"
echo "  --acl_index_split dev \\"
echo "  --acl_segmentation shas"
echo ""

echo "=== 参数说明 ==="
echo "ACL评估模式参数:"
echo "--acl_mode: 启用ACL评估模式"
echo "--acl_root_dir: ACL数据集根目录 (默认: data/acl-6060/2/acl_6060)"
echo "--acl_glossary_path: ACL术语词汇表CSV文件路径"
echo "--acl_test_split: 用于测试的数据分割 (dev/eval)"
echo "--acl_index_split: 用于构建索引的数据分割 (dev/eval)"
echo "--acl_segmentation: 分段类型 (gold/shas)"
echo ""

echo "=== 评估流程 ==="
echo "1. 从ACL术语词汇表或dev set提取术语构建检索索引"
echo "2. 加载ACL测试集的分段音频和对应的术语标注"
echo "3. 使用训练好的SONAR模型对音频进行编码"
echo "4. 在术语索引中检索，计算recall@1, recall@5, recall@10"
echo "5. 保存评估结果到JSON文件"
echo ""

echo "=== 数据集信息 ==="
echo "- ACL 60-60数据集包含多语言会议录音"
echo "- dev和eval分割都包含标注的术语"
echo "- gold分段：人工标注的句子边界"
echo "- shas分段：自动分段系统的结果"
echo "- 术语用方括号标记，如 [machine learning]" 