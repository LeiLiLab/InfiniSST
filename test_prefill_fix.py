#!/usr/bin/env python3\n\"\"\"\næµ‹è¯•PREFILLä¿®å¤æ•ˆæœ\néªŒè¯ä¿®å¤åçš„schedulerä¸ä¼šå‡ºç°é‡å¤prefillé—®é¢˜\n\"\"\"\n\nimport requests\nimport time\nimport json\n\ndef test_prefill_fix(server_url=\"https://infinisst.ngrok.app\"):\n    \"\"\"æµ‹è¯•prefillä¿®å¤æ•ˆæœ\"\"\"\n    print(\"ğŸ§ª æµ‹è¯•PREFILLä¿®å¤æ•ˆæœ\")\n    print(\"=\" * 50)\n    \n    # è¿ç»­æ£€æŸ¥å‡ æ¬¡é˜Ÿåˆ—çŠ¶æ€\n    for i in range(5):\n        try:\n            response = requests.get(f\"{server_url}/diagnose\", timeout=5)\n            if response.status_code == 200:\n                data = response.json()\n                queue_stats = data.get('queue_stats', {})\n                detailed_info = queue_stats.get('detailed_queue_info', {})\n                \n                total_prefill = 0\n                total_decode = 0\n                \n                for gpu_id, info in detailed_info.items():\n                    prefill_count = info.get('prefill_queue_size', 0)\n                    decode_count = info.get('decode_queue_size', 0)\n                    total_prefill += prefill_count\n                    total_decode += decode_count\n                    \n                    language = info.get('language', 'unknown')\n                    print(f\"Check {i+1} - GPU {gpu_id} ({language}): {prefill_count}P + {decode_count}D\")\n                \n                active_sessions = queue_stats.get('active_sessions', 0)\n                \n                # æ£€æŸ¥æ˜¯å¦ä¿®å¤äº†prefillé‡å¤é—®é¢˜\n                if total_prefill > 1:\n                    print(f\"   ğŸš¨ ä»ç„¶å­˜åœ¨å¤šä¸ªPREFILL: {total_prefill} ä¸ª\")\n                elif total_prefill == 1:\n                    print(f\"   âœ… PREFILLæ­£å¸¸: {total_prefill} ä¸ª\")\n                else:\n                    print(f\"   â„¹ï¸ æ— PREFILLè¯·æ±‚\")\n                \n                print(f\"   ğŸ“Š æ€»è®¡: {total_prefill}P + {total_decode}D, {active_sessions} sessions\")\n                print()\n                \n            else:\n                print(f\"Check {i+1} - âŒ APIé”™è¯¯: {response.status_code}\")\n                \n        except Exception as e:\n            print(f\"Check {i+1} - âŒ æ£€æŸ¥å¤±è´¥: {e}\")\n        \n        if i < 4:  # æœ€åä¸€æ¬¡ä¸ç­‰å¾…\n            time.sleep(3)\n    \n    print(\"âœ… æµ‹è¯•å®Œæˆ\")\n\nif __name__ == \"__main__\":\n    test_prefill_fix() 