<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>InfiniSST Translation</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: rgba(16, 18, 22, 0.98); /* 更黑的背景 */
            color: #ffffff;
            height: 100vh;
            display: flex;
            flex-direction: column;
            backdrop-filter: blur(20px);
            border-radius: 12px; /* 添加圆角 */
            overflow: hidden; /* 确保圆角生效 */
            border: 1px solid rgba(255, 255, 255, 0.15); /* 微妙的边框 */
            --font-size: 14px; /* CSS variable for font size */
            -webkit-app-region: drag; /* 让整个窗口可拖拽 */
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5); /* 更深的阴影 */
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 6px 12px; /* 减少padding让整体更紧凑 */
            background: rgba(0, 0, 0, 0.4); /* 更黑的header背景 */
            border-bottom: 1px solid rgba(255, 255, 255, 0.1); /* 更微妙的分割线 */
            user-select: none;
            flex-shrink: 0; /* 防止header被压缩 */
        }

        .title {
            font-size: 12px;
            font-weight: 600;
            color: #ffffff;
            display: flex;
            align-items: center;
            gap: 8px;
            flex: 1; /* 允许标题区域伸缩 */
            min-width: 0; /* 防止文字溢出 */
        }

        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #4caf50;
            transition: background-color 0.3s ease;
        }

        .status-indicator.processing {
            background: #ff9800;
            animation: pulse 2s infinite;
        }

        .status-indicator.error {
            background: #f44336;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .controls {
            display: flex;
            gap: 4px;
            -webkit-app-region: no-drag; /* 确保按钮区域可以正常交互 */
        }

        .control-btn {
            width: 20px;
            height: 20px;
            border: none;
            border-radius: 4px;
            background: rgba(255, 255, 255, 0.1); /* 调整按钮背景 */
            color: #ffffff;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            transition: background-color 0.2s ease;
        }

        .control-btn:hover {
            background: rgba(255, 255, 255, 0.2); /* 调整hover状态 */
        }

        .control-btn.reset {
            background: linear-gradient(45deg, #4facfe 0%, #00f2fe 100%);
            font-size: 10px;
            font-weight: 600;
            width: 40px;
        }

        .control-btn.reset:hover {
            background: linear-gradient(45deg, #369ef7 0%, #00d4fe 100%);
            transform: translateY(-1px);
        }

        .control-btn.close {
            background: rgba(244, 67, 54, 0.8);
            color: white;
            font-weight: bold;
            font-size: 14px;
        }

        .control-btn.close:hover {
            background: rgba(244, 67, 54, 1);
            transform: translateY(-1px);
        }

        .content {
            flex: 1;
            padding: 0; /* 移除所有padding，让内容贴近边缘 */
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            transition: all 0.3s ease;
            -webkit-app-region: no-drag; /* 确保内容区域可以正常交互 */
        }

        .translation-output {
            flex: 1;
            background: transparent; /* 透明背景，与窗口背景融为一体 */
            border: none; /* 移除边框 */
            border-radius: 0; /* 移除圆角 */
            padding: 12px; /* 保留少量内边距用于文字可读性 */
            font-size: var(--font-size);
            line-height: 1.5;
            white-space: pre-wrap;
            overflow-y: auto;
            min-height: 80px; /* 增加最小高度 */
            color: #ffffff;
        }

        .translation-output:empty::before {
            content: "Translation appears here...";
            color: #999; /* 在黑色背景下合适的灰色 */
            font-style: italic;
        }

        /* 自定义滚动条 */
        .translation-output::-webkit-scrollbar {
            width: 6px;
        }

        .translation-output::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05); /* 更暗的滚动条轨道 */
            border-radius: 3px;
        }

        .translation-output::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2); /* 调整滚动条颜色 */
            border-radius: 3px;
        }

        .translation-output::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.3); /* 调整hover状态 */
        }

        .font-controls {
            display: flex;
            align-items: center;
            gap: 4px;
            margin-right: 8px;
        }

        .font-btn {
            width: 24px;
            height: 20px;
            border: none;
            border-radius: 4px;
            background: rgba(255, 255, 255, 0.1);
            color: #ffffff;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: bold;
            transition: background-color 0.2s ease;
        }

        .font-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .font-size-display {
            font-size: 10px;
            font-weight: 600;
            color: #ffffff;
            margin: 0 2px;
            min-width: 24px;
            text-align: center;
        }
    </style>
</head>

<body>
    <div class="header">
        <div class="title">
            <div class="status-indicator" id="statusIndicator"></div>
            <span id="statusText">Ready</span>
        </div>
        <div class="controls">
            <div class="font-controls">
                <button class="control-btn font-btn" id="fontDecreaseBtn" title="Decrease Font Size">A−</button>
                <span class="font-size-display" id="fontSizeDisplay">14px</span>
                <button class="control-btn font-btn" id="fontIncreaseBtn" title="Increase Font Size">A+</button>
            </div>
            <button class="control-btn reset" id="resetBtn" title="Reset Translation">Reset</button>
            <button class="control-btn" id="hideBtn" title="Hide Window">−</button>
            <button class="control-btn close" id="closeBtn" title="Close Window">×</button>
        </div>
    </div>

    <div class="content">
        <div class="translation-output" id="translationOutput"></div>
    </div>

    <script>
    // DOM 元素
    const statusIndicator = document.getElementById('statusIndicator');
    const statusText = document.getElementById('statusText');
    const translationOutput = document.getElementById('translationOutput');
    const resetBtn = document.getElementById('resetBtn');
    const hideBtn = document.getElementById('hideBtn');
    const closeBtn = document.getElementById('closeBtn');
    const fontDecreaseBtn = document.getElementById('fontDecreaseBtn');
    const fontIncreaseBtn = document.getElementById('fontIncreaseBtn');
    const fontSizeDisplay = document.getElementById('fontSizeDisplay');

    // 字体大小设置
    let currentFontSize = 14;

    // 字体大小控制函数
    function updateFontSize(newSize) {
        currentFontSize = Math.max(10, Math.min(24, newSize)); // 限制字体大小范围 10-24px
        document.body.style.setProperty('--font-size', currentFontSize + 'px');
        fontSizeDisplay.textContent = currentFontSize + 'px';
        
        // 保存到本地存储
        localStorage.setItem('translationFontSize', currentFontSize);
    }

    function increaseFontSize() {
        updateFontSize(currentFontSize + 2);
    }

    function decreaseFontSize() {
        updateFontSize(currentFontSize - 2);
    }

    // 从本地存储加载字体大小
    function loadFontSize() {
        const savedSize = localStorage.getItem('translationFontSize');
        if (savedSize) {
            updateFontSize(parseInt(savedSize));
        }
    }

    // 检查 electronAPI 是否可用
    if (typeof window !== 'undefined' && window.electronAPI) {
        // 监听翻译更新
        window.electronAPI.onTranslationUpdate((event, translationData) => {
           if (translationData && translationData.text) {
               translationOutput.textContent = translationData.text;
               // 自动滚动到底部
               translationOutput.scrollTop = translationOutput.scrollHeight;
           }
       });

       // 监听状态更新
       window.electronAPI.onStatusUpdate((event, statusData) => {
           if (statusData) {
               statusText.textContent = statusData.text || 'Ready';
               
               // 更新状态指示器
               statusIndicator.className = 'status-indicator';
               if (statusData.type === 'processing') {
                   statusIndicator.classList.add('processing');
               } else if (statusData.type === 'error') {
                   statusIndicator.classList.add('error');
               }
           }
       });

       // 控制按钮事件
       resetBtn.addEventListener('click', () => {
           // 清空翻译内容
           translationOutput.textContent = '';
           // 调用主窗口的重置函数
           if (window.electronAPI && window.electronAPI.resetTranslation) {
               window.electronAPI.resetTranslation();
           }
       });

       hideBtn.addEventListener('click', () => {
           if (window.electronAPI && window.electronAPI.minimizeTranslationWindow) {
               window.electronAPI.minimizeTranslationWindow();
           }
       });

       closeBtn.addEventListener('click', () => {
           if (window.electronAPI && window.electronAPI.closeTranslationWindow) {
               window.electronAPI.closeTranslationWindow();
           } else {
               window.close();
           }
       });

       // 字体大小控制事件
       fontDecreaseBtn.addEventListener('click', decreaseFontSize);
       fontIncreaseBtn.addEventListener('click', increaseFontSize);
       
       // 加载保存的字体大小
       loadFontSize();
    } else {
        console.warn('electronAPI not available in translation window');
        statusText.textContent = 'electronAPI not available';
    }

    // 键盘快捷键支持
    document.addEventListener('keydown', (e) => {
        // Ctrl/Cmd + Plus: 增大字体
        if ((e.ctrlKey || e.metaKey) && (e.key === '+' || e.key === '=')) {
            e.preventDefault();
            increaseFontSize();
        }
        // Ctrl/Cmd + Minus: 减小字体
        else if ((e.ctrlKey || e.metaKey) && e.key === '-') {
            e.preventDefault();
            decreaseFontSize();
        }
        // Ctrl/Cmd + 0: 重置字体大小
        else if ((e.ctrlKey || e.metaKey) && e.key === '0') {
            e.preventDefault();
            updateFontSize(14);
        }
    });

    // 防止窗口内容被选中时影响拖拽
    document.addEventListener('selectstart', (e) => {
        if (e.target.tagName !== 'INPUT') {
            e.preventDefault();
        }
    });
    </script>
</body>
</html> 